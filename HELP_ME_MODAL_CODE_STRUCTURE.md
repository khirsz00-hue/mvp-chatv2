# HelpMeModal - Code Structure Visualization

## Component Architecture

```
HelpMeModal
â”œâ”€â”€ Props
â”‚   â”œâ”€â”€ task: Task (with id, title, description)
â”‚   â”œâ”€â”€ open: boolean
â”‚   â”œâ”€â”€ onClose: () => void
â”‚   â””â”€â”€ onSuccess: () => void (triggers parent reload)
â”‚
â”œâ”€â”€ State Management
â”‚   â”œâ”€â”€ stage: 'questions' | 'review' | 'edit'
â”‚   â”œâ”€â”€ loading: boolean
â”‚   â”œâ”€â”€ Questions State
â”‚   â”‚   â”œâ”€â”€ whatToDo: string
â”‚   â”‚   â”œâ”€â”€ completionCriteria: string
â”‚   â”‚   â””â”€â”€ blockers: string
â”‚   â”œâ”€â”€ steps: Step[] (generated by AI)
â”‚   â””â”€â”€ editingSteps: Step[] (for edit mode)
â”‚
â””â”€â”€ Three Stages
    â”œâ”€â”€ 1. QUESTIONS STAGE (lines 189-265)
    â”‚   â”œâ”€â”€ Three text areas for user input
    â”‚   â”œâ”€â”€ "Anuluj" button â†’ closes modal
    â”‚   â””â”€â”€ "Wygeneruj kroki" button â†’ calls handleGenerateSteps()
    â”‚       â””â”€â”€ POST /api/day-assistant-v2/decompose
    â”‚
    â”œâ”€â”€ 2. REVIEW STAGE (lines 266-305)
    â”‚   â”œâ”€â”€ Display generated steps (read-only checkboxes)
    â”‚   â””â”€â”€ Three action buttons:
    â”‚       â”œâ”€â”€ "ðŸ”„ Doprecyzuj ponownie" â†’ handleRefineAgain()
    â”‚       â”‚   â””â”€â”€ Returns to questions, keeps answers
    â”‚       â”œâ”€â”€ "â†©ï¸ Edytuj" â†’ handleEdit()
    â”‚       â”‚   â””â”€â”€ Copies steps to editingSteps, switches to edit stage
    â”‚       â””â”€â”€ "âœ… Akceptuj kroki" â†’ handleAcceptSteps() â† FIXED
    â”‚           â”œâ”€â”€ Get auth session from Supabase
    â”‚           â”œâ”€â”€ POST /api/day-assistant-v2/subtasks/bulk
    â”‚           â”‚   with Authorization header
    â”‚           â”œâ”€â”€ Show success toast
    â”‚           â”œâ”€â”€ Call onSuccess() â†’ triggers parent reload
    â”‚           â””â”€â”€ Close modal
    â”‚
    â””â”€â”€ 3. EDIT STAGE (lines 306-368)
        â”œâ”€â”€ For each step:
        â”‚   â”œâ”€â”€ Title input (editable)
        â”‚   â”œâ”€â”€ Duration input (editable, type=number)
        â”‚   â””â”€â”€ Delete button (ðŸ—‘ï¸) â†’ handleDeleteStep(index)
        â”œâ”€â”€ "Dodaj krok" button â†’ handleAddStep()
        â”‚   â””â”€â”€ Adds new step with default values
        â””â”€â”€ Action buttons:
            â”œâ”€â”€ "âŒ Anuluj" â†’ handleCancelEdit()
            â”‚   â””â”€â”€ Discards changes, returns to review
            â””â”€â”€ "ðŸ’¾ Zapisz zmiany" â†’ handleSaveEdits()
                â””â”€â”€ Applies changes to steps, returns to review
```

## Key Functions

### handleGenerateSteps() (lines 47-98)
```typescript
// Validates input â†’ Calls AI API â†’ Switches to review stage
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Validate required fields             â”‚
â”‚ 2. POST /api/day-assistant-v2/decompose â”‚
â”‚    - task_id, task_title                â”‚
â”‚    - what_to_do, completion_criteria    â”‚
â”‚    - blockers (optional)                â”‚
â”‚ 3. Parse AI response                    â”‚
â”‚ 4. setSteps(data.steps)                 â”‚
â”‚ 5. setStage('review')                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### handleAcceptSteps() (lines 100-145) â† FIXED
```typescript
// Creates subtasks in database with authentication
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Get session from Supabase â† ADDED        â”‚
â”‚ 2. Validate session â† ADDED                 â”‚
â”‚ 3. POST /api/day-assistant-v2/subtasks/bulk â”‚
â”‚    Headers: â† ADDED                          â”‚
â”‚      - Content-Type: application/json       â”‚
â”‚      - Authorization: Bearer {token}        â”‚
â”‚    Body:                                     â”‚
â”‚      - task_id                              â”‚
â”‚      - steps array with content, duration   â”‚
â”‚ 4. Handle errors with specific messages     â”‚
â”‚ 5. Show success toast                       â”‚
â”‚ 6. onSuccess() â†’ triggers parent reload     â”‚
â”‚ 7. onClose() â†’ closes modal                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### handleEdit() (lines 147-150)
```typescript
// Switches to edit mode
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Copy steps to editingStepsâ”‚
â”‚ 2. setStage('edit')          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### handleRefineAgain() (lines 152-155)
```typescript
// Returns to questions without clearing
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. setStage('questions')     â”‚
â”‚ 2. Keeps all form values     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### handleUpdateStep(index, field, value) (lines 167-175)
```typescript
// Updates a step field during editing
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Clone editingSteps array        â”‚
â”‚ 2. Update specified field          â”‚
â”‚    - 'title' â†’ string              â”‚
â”‚    - 'estimated_minutes' â†’ number  â”‚
â”‚ 3. setEditingSteps(updated)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### handleDeleteStep(index) (lines 177-184)
```typescript
// Removes a step and reorders
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Filter out step at index  â”‚
â”‚ 2. Reorder remaining steps   â”‚
â”‚    (update order property)   â”‚
â”‚ 3. setEditingSteps(updated)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### handleAddStep() (lines 186-193)
```typescript
// Adds a new blank step
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Create new step object        â”‚
â”‚    - title: 'Nowy krok'          â”‚
â”‚    - estimated_minutes: 15       â”‚
â”‚    - order: length + 1           â”‚
â”‚ 2. Append to editingSteps        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### handleSaveEdits() (lines 157-160)
```typescript
// Applies edit changes
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Copy editingSteps to stepsâ”‚
â”‚ 2. setStage('review')        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### handleCancelEdit() (lines 162-165)
```typescript
// Discards edit changes
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Clear editingSteps        â”‚
â”‚ 2. setStage('review')        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow

### Creating Subtasks Flow
```
User clicks "Akceptuj kroki"
         â†“
handleAcceptSteps()
         â†“
Get Supabase session â† FIXED
         â†“
Validate session â† FIXED
         â†“
POST /api/day-assistant-v2/subtasks/bulk
  with Authorization header â† FIXED
         â†“
API creates subtasks in database
         â†“
Success response
         â†“
Show toast: "âœ… Kroki utworzone!"
         â†“
onSuccess() â†’ DayAssistantV2View.loadData()
         â†“
Reload tasks from API
         â†“
Task cards re-render
         â†“
DayAssistantV2TaskCard.fetchFirstSubtask()
         â†“
GET /api/day-assistant-v2/subtasks?task_id={id}
         â†“
Display first subtask on card
  "ðŸ“ Pierwszy krok: {title} (~{duration} min)"
```

## Task Card Integration

### DayAssistantV2TaskCard.tsx Structure
```
DayAssistantV2TaskCard
â”œâ”€â”€ State
â”‚   â””â”€â”€ firstSubtask: TestDaySubtask | null
â”‚
â”œâ”€â”€ fetchFirstSubtask() callback (lines 68-90)
â”‚   â”œâ”€â”€ Get auth session
â”‚   â”œâ”€â”€ GET /api/day-assistant-v2/subtasks?task_id={task.id}
â”‚   â”‚   with Authorization header
â”‚   â”œâ”€â”€ Find first incomplete subtask
â”‚   â””â”€â”€ setFirstSubtask(subtask)
â”‚
â”œâ”€â”€ useEffect (lines 93-97)
â”‚   â”œâ”€â”€ Dependencies: [task.id, isCompact, isOverflow]
â”‚   â”œâ”€â”€ Only for full-size cards
â”‚   â””â”€â”€ Calls fetchFirstSubtask()
â”‚
â””â”€â”€ Render (lines 243-250)
    â””â”€â”€ If firstSubtask exists:
        Display:
          ðŸ“ Pierwszy krok: {content} (~{duration} min)
```

## Component Interaction Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DayAssistantV2View        â”‚
â”‚  (Parent Component)         â”‚
â”‚                             â”‚
â”‚  - loadData()              â”‚ â† Reloads all tasks
â”‚  - handleHelp(taskId)      â”‚ â† Opens modal
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ opens
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      HelpMeModal            â”‚
â”‚                             â”‚
â”‚  Props:                     â”‚
â”‚  - task                     â”‚
â”‚  - open                     â”‚
â”‚  - onClose                  â”‚
â”‚  - onSuccess â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                         â”‚   â”‚
â”‚  Stages:                â”‚   â”‚
â”‚  1. Questions           â”‚   â”‚
â”‚  2. Review              â”‚   â”‚
â”‚  3. Edit                â”‚   â”‚
â”‚                         â”‚   â”‚
â”‚  On "Akceptuj kroki":   â”‚   â”‚
â”‚  - Create subtasks      â”‚   â”‚
â”‚  - Call onSuccess() â”€â”€â”€â”€â”˜   â”‚
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ triggers
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DayAssistantV2View        â”‚
â”‚   loadData()                â”‚
â”‚                             â”‚
â”‚   Re-fetches tasks          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ re-renders
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DayAssistantV2TaskCard     â”‚
â”‚                             â”‚
â”‚  useEffect triggers on      â”‚
â”‚  task.id change             â”‚
â”‚         â†“                   â”‚
â”‚  fetchFirstSubtask()        â”‚
â”‚         â†“                   â”‚
â”‚  GET /api/.../subtasks      â”‚
â”‚         â†“                   â”‚
â”‚  Display first subtask      â”‚
â”‚  "ðŸ“ Pierwszy krok: ..."    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## UI States

### Questions Stage
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš¡ PomÃ³Å¼ mi rozpoczÄ…Ä‡              â”‚
â”‚  Zadanie: [Task Title]             â”‚
â”‚                                    â”‚
â”‚  1. Na czym dokÅ‚adnie polega...* â”‚
â”‚  [Text area]                       â”‚
â”‚                                    â”‚
â”‚  2. Po czym poznasz Å¼e jest...*   â”‚
â”‚  [Text area]                       â”‚
â”‚                                    â”‚
â”‚  3. Co CiÄ™ blokuje?               â”‚
â”‚  [Text area]                       â”‚
â”‚                                    â”‚
â”‚  [âŒ Anuluj] [âœ¨ Wygeneruj kroki] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Review Stage
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš¡ PomÃ³Å¼ mi rozpoczÄ…Ä‡              â”‚
â”‚  Zadanie: [Task Title]             â”‚
â”‚                                    â”‚
â”‚  ðŸ’¡ AI zaproponowaÅ‚ 5 krokÃ³w:      â”‚
â”‚                                    â”‚
â”‚  â˜ 1. [Step title]                â”‚
â”‚     ~30 min                        â”‚
â”‚  â˜ 2. [Step title]                â”‚
â”‚     ~20 min                        â”‚
â”‚  ...                               â”‚
â”‚                                    â”‚
â”‚  [ðŸ”„ Doprecyzuj ponownie]         â”‚
â”‚  [â†©ï¸ Edytuj] [âœ… Akceptuj kroki]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Edit Stage
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš¡ PomÃ³Å¼ mi rozpoczÄ…Ä‡              â”‚
â”‚  Zadanie: [Task Title]             â”‚
â”‚                                    â”‚
â”‚  âœï¸ Edytuj kroki:                  â”‚
â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”  â”‚
â”‚  â”‚ Krok 1                  â”‚ðŸ—‘ï¸â”‚  â”‚
â”‚  â”‚ [Input: title]          â”‚   â”‚  â”‚
â”‚  â”‚ Czas (min): [15]        â”‚   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”  â”‚
â”‚  â”‚ Krok 2                  â”‚ðŸ—‘ï¸â”‚  â”‚
â”‚  â”‚ [Input: title]          â”‚   â”‚  â”‚
â”‚  â”‚ Czas (min): [20]        â”‚   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”˜  â”‚
â”‚  ...                               â”‚
â”‚                                    â”‚
â”‚  [+ Dodaj krok]                    â”‚
â”‚                                    â”‚
â”‚  [âŒ Anuluj] [ðŸ’¾ Zapisz zmiany]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Task Card with First Subtask
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MUST  P1  ðŸ’» Code  ðŸ§  3/5          â”‚
â”‚                                     â”‚
â”‚ [Task Title]                        â”‚
â”‚ ðŸ“ Pierwszy krok: Skontaktuj siÄ™... â”‚
â”‚    (~30 min)                        â”‚
â”‚                                     â”‚
â”‚ Due: 2024-01-25                     â”‚
â”‚                              [â‹®][â–¶]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## API Interaction

### POST /api/day-assistant-v2/decompose
```
Request:
{
  "task_id": "uuid",
  "task_title": "string",
  "what_to_do": "string",
  "completion_criteria": "string",
  "blockers": "string | null"
}

Response:
{
  "steps": [
    {
      "title": "string",
      "estimated_minutes": number,
      "order": number
    }
  ],
  "warning": "string (optional)"
}
```

### POST /api/day-assistant-v2/subtasks/bulk â† FIXED
```
Request:
Headers:
  Content-Type: application/json
  Authorization: Bearer {token} â† ADDED

Body:
{
  "task_id": "uuid",
  "steps": [
    {
      "content": "string",
      "estimated_duration": number,
      "position": number
    }
  ]
}

Response:
{
  "subtasks": [
    {
      "id": "uuid",
      "task_id": "uuid",
      "content": "string",
      "estimated_duration": number,
      "position": number,
      "completed": false,
      "created_at": "timestamp"
    }
  ]
}
```

### GET /api/day-assistant-v2/subtasks
```
Request:
Query: ?task_id={uuid}
Headers:
  Authorization: Bearer {token}

Response:
{
  "subtasks": [
    {
      "id": "uuid",
      "task_id": "uuid",
      "content": "string",
      "estimated_duration": number,
      "completed": boolean,
      "completed_at": "timestamp | null",
      "position": number,
      "created_at": "timestamp"
    }
  ]
}
```

## Error Handling

### handleAcceptSteps Error Cases
```
1. Session expired/missing
   â†’ Toast: "Sesja wygasÅ‚a - zaloguj siÄ™ ponownie"
   â†’ Don't call API

2. API error (401, 403, 500, etc.)
   â†’ Parse error from response
   â†’ Toast: "âŒ {specific error message}"

3. Network error
   â†’ Toast: "âŒ Nie udaÅ‚o siÄ™ utworzyÄ‡ krokÃ³w"

4. Success
   â†’ Toast: "âœ… Kroki utworzone!"
   â†’ onSuccess() â†’ parent reload
   â†’ Modal closes
```

## Dependencies

### Imported Libraries
- `react` - useState hook for state management
- `@/components/ui/*` - Dialog, Button, Input, Textarea, Label, Checkbox
- `@phosphor-icons/react` - ArrowsClockwise, Trash, Plus icons
- `sonner` - Toast notifications
- `@/lib/supabaseClient` - Authentication â† ADDED

### Type Definitions
```typescript
interface Task {
  id: string
  title: string
  description?: string | null | undefined
}

interface Step {
  title: string
  estimated_minutes: number
  order: number
}

interface Props {
  task: Task
  open: boolean
  onClose: () => void
  onSuccess: () => void
}
```

## Summary of Changes

### What Was Fixed âœ…
- **Line 12**: Added `import { supabase } from '@/lib/supabaseClient'`
- **Lines 100-145**: Updated `handleAcceptSteps()`:
  - Get authentication session
  - Validate session
  - Add Authorization header to API call
  - Improved error handling

### What Was Already Working âœ…
- All three stages (questions, review, edit)
- All buttons and handlers
- Edit functionality (add, edit, delete steps)
- "Doprecyzuj ponownie" button
- First subtask display on task cards
- API integration
- User flow

### Impact
- **Before**: 401 Unauthorized error when creating subtasks
- **After**: Subtasks created successfully in database, visible on task cards
